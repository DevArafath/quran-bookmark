<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Surah and Verse Selector</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap');

        body {
            font-family: 'Rubik', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
        }

        .card {
            max-width: 500px;
            margin: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
        }

        .card-body {
            padding: 20px;
        }

        #surah-arabic,
        #saved-bookmark-arabic {
            font-family: 'Rubik', 'Amiri';
            font-size: 24px;
            text-align: center;
            direction: rtl;
        }

        #saved-bookmark-container {
            margin-top: 20px;
            text-align: center;
        }

        #bookmark-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        #saved-bookmark,
        #saved-bookmark-arabic {
            font-weight: bold;
            margin-top: 5px;
        }

        button {
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
            color: #fff;
        }

        @media (max-width: 576px) {
            .card-body {
                padding: 15px;
            }

            h5 {
                font-size: 1.25rem;
            }
        }
    </style>
    <!-- Link to Google Fonts for Arabic support -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
</head>

<body>
    <div class="card">
        <div class="card-body">
            <h5 class="card-title text-center">Quran Surah and Verse Selector</h5>

            <div class="mb-3">
                <label for="surah-dropdown" class="form-label">Select Surah (English):</label>
                <select class="form-select" id="surah-dropdown" aria-label="Select Surah in English">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>

            <div class="mb-3">
                <label for="surah-arabic" class="form-label">Surah (Arabic):</label>
                <p id="surah-arabic" class="text-center">اختر السورة</p>
            </div>

            <div class="mb-3">
                <label for="verse-dropdown" class="form-label">Select Verse:</label>
                <select class="form-select" id="verse-dropdown" aria-label="Select Verse">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <div class="d-grid gap-2">
                <button id="save-bookmark" class="btn btn-primary">Save Bookmark</button>
                <button id="reset-bookmark" class="btn btn-secondary">Reset Bookmark</button>
            </div>

            <div id="saved-bookmark-container">
                <p id="bookmark-title">Bookmark | إشارة مرجعية</p>
                <p id="saved-bookmark"></p>
                <p id="saved-bookmark-arabic"></p>
            </div>

            <div class="text-center text-danger text-bg-warning rounded-3 p-2">
                <label for="juz-number">Current Juz' :&nbsp</label>
                <span id="juz-number">N/A</span>
            </div>

        </div>
    </div>

<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
    const surahDropdown = document.getElementById('surah-dropdown');
    const surahArabicLabel = document.getElementById('surah-arabic');
    const verseDropdown = document.getElementById('verse-dropdown');
    const savedBookmark = document.getElementById('saved-bookmark');
    const savedBookmarkArabic = document.getElementById('saved-bookmark-arabic');
    const saveButton = document.getElementById('save-bookmark');
    const juzLabel = document.getElementById('juz-number');

    // Fetch Surah and Juz data dynamically
    async function fetchSurahs() {
        const response = await fetch('quran-surah-data.json'); // Update with your JSON file path
        return await response.json();
    }

    async function fetchJuzData() {
        const response = await fetch('quran-juz-data.json'); // Update with your JSON file path
        return await response.json();
    }

    // Convert numbers to Arabic numerals
    function toArabicNumerals(num) {
        return num.toString().replace(/\d/g, d => '٠١٢٣٤٥٦٧٨٩'[d]);
    }

    // Populate the Surah dropdown
    function populateSurahDropdown(surahs) {
        surahs.forEach((surah, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = surah.english;
            surahDropdown.appendChild(option);
        });
    }

    // Populate the verse dropdown based on selected Surah
    function populateVerseDropdown(verses) {
        verseDropdown.innerHTML = '';
        for (let i = 1; i <= verses; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            verseDropdown.appendChild(option);
        }
    }

    // Calculate and display the Juz' number based on the selected verse
    function calculateJuz(selectedSurahIndex, selectedVerse, juzData) {
        let juzNumber = 1;
        for (let i = 0; i < juzData.length; i++) {
            const juz = juzData[i];
            if (selectedSurahIndex + 1 > juz.surah || (selectedSurahIndex + 1 === juz.surah && selectedVerse >= juz.verse)) {
                juzNumber = juz.juz;
            }
        }
        return juzNumber;
    }

    // Display the selected Surah in Arabic and calculate Juz'
    function displaySelectedSurah(surahs, juzData) {
        const selectedSurah = surahs[surahDropdown.value];
        const surahNumber = parseInt(surahDropdown.value) + 1;
        const arabicSurahNumber = toArabicNumerals(surahNumber);
        surahArabicLabel.textContent = `${arabicSurahNumber}. ${selectedSurah.arabic}`;
        populateVerseDropdown(selectedSurah.verses);
        displayJuzNumber(surahs, juzData); // Display Juz' number on Surah change
    }

    // Display the Juz' number based on the selected verse
    function displayJuzNumber(surahs, juzData) {
        const selectedSurahIndex = parseInt(surahDropdown.value);
        const selectedVerse = parseInt(verseDropdown.value);
        const juzNumber = calculateJuz(selectedSurahIndex, selectedVerse, juzData);
        juzLabel.textContent = `Juz': ${juzNumber}`;
    }

    // Load saved bookmark from localStorage
    function loadSavedBookmark() {
        const savedData = localStorage.getItem('bookmark');
        const savedDataArabic = localStorage.getItem('bookmarkArabic');
        const savedJuz = localStorage.getItem('juzNumber');
        if (savedData) {
            savedBookmark.textContent = savedData;
        }
        if (savedDataArabic) {
            savedBookmarkArabic.textContent = savedDataArabic;
        }
        if (savedJuz) {
            juzLabel.textContent = `Juz': ${savedJuz}`;
        }
    }

    // Save bookmark
    function saveBookmark(surahs, juzData) {
        const selectedIndex = surahDropdown.selectedIndex;
        const selectedSurah = surahs[selectedIndex];
        const surahNumber = selectedIndex + 1;
        const arabicSurahNumber = toArabicNumerals(surahNumber);
        const selectedVerse = verseDropdown.value;
        const arabicSelectedVerse = toArabicNumerals(selectedVerse);

        const bookmark = `${selectedSurah.english}, Verse: ${selectedVerse}`;
        const bookmarkArabic = `${arabicSurahNumber} . ${selectedSurah.arabic}، الآية: ${arabicSelectedVerse}`;
        const juzNumber = calculateJuz(selectedIndex, parseInt(selectedVerse), juzData);

        // Save to localStorage
        localStorage.setItem('bookmark', bookmark);
        localStorage.setItem('bookmarkArabic', bookmarkArabic);
        localStorage.setItem('juzNumber', juzNumber);

        // Display saved bookmark
        savedBookmark.textContent = bookmark;
        savedBookmarkArabic.textContent = bookmarkArabic;
        juzLabel.textContent = `Juz': ${juzNumber}`;
    }

    // Reset bookmark
    function resetBookmark() {
        // Clear localStorage
        localStorage.removeItem('bookmark');
        localStorage.removeItem('bookmarkArabic');
        localStorage.removeItem('juzNumber');

        // Clear displayed bookmark
        savedBookmark.textContent = '';
        savedBookmarkArabic.textContent = '';
        juzLabel.textContent = 'Juz\': N/A';
    }

    // Event listeners
    surahDropdown.addEventListener('change', function() {
        Promise.all([fetchSurahs(), fetchJuzData()]).then(([surahs, juzData]) => {
            displaySelectedSurah(surahs, juzData);
        });
    });

    verseDropdown.addEventListener('change', function() {
        Promise.all([fetchSurahs(), fetchJuzData()]).then(([surahs, juzData]) => {
            displayJuzNumber(surahs, juzData);
        });
    });

    saveButton.addEventListener('click', function () {
        Promise.all([fetchSurahs(), fetchJuzData()]).then(([surahs, juzData]) => {
            if (surahDropdown.value !== "" && verseDropdown.value !== "") {
                saveBookmark(surahs, juzData);
            } else {
                alert("Please select both a Surah and a Verse before saving.");
            }
        });
    });

    document.getElementById('reset-bookmark').addEventListener('click', resetBookmark);

    // Initial setup
    Promise.all([fetchSurahs(), fetchJuzData()]).then(([surahs, juzData]) => {
        populateSurahDropdown(surahs);
        loadSavedBookmark();
    });
    });

</script>
</body>

</html>
